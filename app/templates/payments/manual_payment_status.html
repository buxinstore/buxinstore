{% extends "base.html" %}

{% block title %}Payment Status - buxin store{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto pt-12 pb-20 px-4 sm:px-6 lg:px-8">
    <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-lg p-6 sm:p-8">
        <h1 class="text-2xl font-bold text-slate-900 dark:text-white mb-6">Payment Status</h1>
        
        <!-- Payment Status Badge -->
        <div class="mb-6">
            {% if manual_payment.status == 'pending' %}
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 rounded-lg">
                    <span class="text-xl">⏳</span>
                    <span class="font-semibold">Waiting for Approval</span>
                </div>
            {% elif manual_payment.status == 'approved' %}
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded-lg">
                    <span class="text-xl">✅</span>
                    <span class="font-semibold">Payment Approved</span>
                </div>
            {% elif manual_payment.status == 'rejected' %}
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 rounded-lg">
                    <span class="text-xl">❌</span>
                    <span class="font-semibold">Payment Rejected</span>
                </div>
            {% endif %}
        </div>
        
        <!-- Payment Information -->
        <div class="space-y-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Payment Method</p>
                    <p class="font-semibold text-slate-900 dark:text-white">
                        {% if payment_details %}
                            {{ payment_details.display_name }}
                        {% else %}
                            {{ manual_payment.payment_method|replace('_', ' ')|title }}
                        {% endif %}
                    </p>
                </div>
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Amount</p>
                    <p class="font-semibold text-slate-900 dark:text-white">
                        {{ "%.2f"|format(manual_payment.amount) }} 
                        {% if pending_payment and pending_payment.shipping_display_currency %}
                            {{ pending_payment.shipping_display_currency }}
                        {% else %}
                            GMD
                        {% endif %}
                    </p>
                </div>
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Submitted</p>
                    <p class="font-semibold text-slate-900 dark:text-white">
                        {{ manual_payment.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                    </p>
                </div>
                {% if manual_payment.approved_at %}
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Approved</p>
                    <p class="font-semibold text-slate-900 dark:text-white">
                        {{ manual_payment.approved_at.strftime('%B %d, %Y at %I:%M %p') }}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Status Messages -->
        {% if manual_payment.status == 'pending' %}
            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6">
                <p class="text-sm text-blue-800 dark:text-blue-200">
                    <strong>Your payment is being reviewed.</strong> We will notify you once your payment has been approved. 
                    This usually takes 1-2 business days. You can check back here anytime to see the status.
                </p>
            </div>
        {% elif manual_payment.status == 'approved' %}
            <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-6">
                <p class="text-sm text-green-800 dark:text-green-200">
                    <strong>Your payment has been approved!</strong> 
                    {% if manual_payment.order_id %}
                        Your order #{{ manual_payment.order_id }} is now being processed.
                        <a href="{{ url_for('order_confirmation', order_id=manual_payment.order_id) }}" class="underline font-semibold">View Order Confirmation</a>
                    {% else %}
                        Your order is being processed.
                    {% endif %}
                </p>
            </div>
        {% elif manual_payment.status == 'rejected' %}
            <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6">
                <p class="text-sm text-red-800 dark:text-red-200">
                    <strong>Your payment was rejected.</strong>
                    {% if manual_payment.rejection_reason %}
                        <br><br><strong>Reason:</strong> {{ manual_payment.rejection_reason }}
                    {% endif %}
                    <br><br>Please contact support if you believe this is an error, or submit a new payment with a valid receipt.
                </p>
            </div>
        {% endif %}
        
        <!-- Payment Receipt -->
        {% if manual_payment.receipt_url %}
        <div class="mb-6">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-3">Payment Receipt</h2>
            <div class="border border-slate-200 dark:border-slate-800 rounded-lg p-4 bg-slate-50 dark:bg-slate-900/50">
                <img src="{{ manual_payment.receipt_url }}" 
                     alt="Payment Receipt" 
                     class="max-w-full h-auto rounded-lg cursor-pointer"
                     onclick="window.open(this.src, '_blank')"
                     style="max-height: 500px;">
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">Click image to view full size</p>
            </div>
        </div>
        {% endif %}
        
        <!-- Payment Details (if available) -->
        {% if payment_details %}
        <div class="mb-6">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-3">Payment Details</h2>
            <div class="bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-lg p-4">
                <div class="space-y-2 text-sm text-slate-700 dark:text-slate-300">
                    {% if payment_details.details %}
                        {% for key, value in payment_details.details.items() %}
                            <div>
                                <strong>{{ key|replace('_', ' ')|title }}:</strong> 
                                <span class="{% if 'ifsc' in key.lower() or 'wave_number' in key.lower() %}font-bold text-cyan-600 dark:text-cyan-400{% endif %}">{{ value }}</span>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Actions -->
        <div class="flex gap-4 mt-6">
            <a href="{{ url_for('home') }}" class="px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">
                Back to Home
            </a>
            {% if manual_payment.order_id %}
            <a href="{{ url_for('order_confirmation', order_id=manual_payment.order_id) }}" class="px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors">
                View Order Confirmation
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

