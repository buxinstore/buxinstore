{% extends "base.html" %}

{% block title %}Edit Post - Discussion Forum{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-6">
        <a href="{{ url_for('forum.post', slug=post.slug) }}" class="inline-flex items-center gap-2 text-[color:var(--app-muted)] hover:text-[color:var(--app-text)] transition-colors">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Back to Post
        </a>
    </div>

    <div class="bg-[color:var(--app-card)] border border-[color:var(--app-border)] rounded-xl p-6">
        <h1 class="text-3xl font-bold text-[color:var(--app-text)] mb-6">Edit Post</h1>

        <form method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <!-- Title -->
            <div class="mb-6">
                <label for="title" class="block text-sm font-medium text-[color:var(--app-text)] mb-2">
                    Title <span class="text-red-500">*</span>
                </label>
                <input type="text" name="title" id="title" value="{{ post.title }}" required
                       class="w-full bg-[color:var(--app-input)] border border-[color:var(--app-border)] rounded-lg px-4 py-3 text-[color:var(--app-text)] focus:outline-none focus:ring-2 focus:ring-cyan-500/50"
                       placeholder="Enter post title...">
            </div>

            <!-- Body -->
            <div class="mb-6">
                <label for="body" class="block text-sm font-medium text-[color:var(--app-text)] mb-2">
                    Content <span class="text-red-500">*</span>
                </label>
                <textarea name="body" id="body" rows="12" required
                          class="w-full bg-[color:var(--app-input)] border border-[color:var(--app-border)] rounded-lg px-4 py-3 text-[color:var(--app-text)] focus:outline-none focus:ring-2 focus:ring-cyan-500/50"
                          placeholder="Write your post content here...">{{ post.body }}</textarea>
            </div>

            <!-- Existing Files -->
            {% if post.files %}
            <div class="mb-6">
                <label class="block text-sm font-medium text-[color:var(--app-text)] mb-2">
                    Current Files
                </label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {% for file in post.files %}
                        {% include 'forum/components/file_preview.html' %}
                    {% endfor %}
                </div>
                <p class="text-sm text-[color:var(--app-muted)] mt-2">
                    You can add more files below (total limit: 5 files)
                </p>
            </div>
            {% endif %}

            <!-- New Files -->
            <div class="mb-6">
                <label for="files" class="block text-sm font-medium text-[color:var(--app-text)] mb-2">
                    Add More Files (Optional, Max 5 files total, 10MB each)
                </label>
                <input type="file" name="files" id="files" multiple
                       class="w-full bg-[color:var(--app-input)] border border-[color:var(--app-border)] rounded-lg px-4 py-3 text-[color:var(--app-text)] focus:outline-none focus:ring-2 focus:ring-cyan-500/50"
                       accept="image/*,.pdf,.doc,.docx,.txt,.zip,.rar,.xls,.xlsx,.ppt,.pptx">
                <p class="text-sm text-[color:var(--app-muted)] mt-2">
                    Allowed: Images, PDFs, Documents, Archives. Max size: 10MB per file.
                </p>
                <div id="file-list" class="mt-3 space-y-2"></div>
            </div>

            <!-- External Links -->
            <div class="mb-6">
                <label for="links" class="block text-sm font-medium text-[color:var(--app-text)] mb-2">
                    External Links (Optional)
                </label>
                <textarea name="links" id="links" rows="4"
                          class="w-full bg-[color:var(--app-input)] border border-[color:var(--app-border)] rounded-lg px-4 py-3 text-[color:var(--app-text)] focus:outline-none focus:ring-2 focus:ring-cyan-500/50"
                          placeholder="Enter URLs, one per line or separated by commas">{{ existing_links }}</textarea>
                <p class="text-sm text-[color:var(--app-muted)] mt-2">
                    Add links to YouTube videos, GitHub repos, blog posts, etc. One URL per line.
                </p>
            </div>

            <!-- Submit Buttons -->
            <div class="flex items-center gap-4">
                <button type="submit" class="bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-cyan-600 hover:to-blue-600 transition-all">
                    Update Post
                </button>
                <a href="{{ url_for('forum.post', slug=post.slug) }}" class="px-6 py-3 border border-[color:var(--app-border)] rounded-lg text-[color:var(--app-text)] hover:bg-[color:var(--app-surface-hover)] transition-colors">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    // File list preview
    document.getElementById('files')?.addEventListener('change', function(e) {
        const fileList = document.getElementById('file-list');
        fileList.innerHTML = '';
        
        const files = Array.from(e.target.files);
        const existingFileCount = {{ post.files|length }};
        
        if (files.length + existingFileCount > 5) {
            alert(`Maximum 5 files total. You already have ${existingFileCount} file(s).`);
            e.target.files = Array.from(files.slice(0, 5 - existingFileCount));
        }
        
        files.slice(0, 5 - existingFileCount).forEach((file) => {
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            const div = document.createElement('div');
            div.className = 'flex items-center justify-between p-2 bg-[color:var(--app-input)] rounded-lg';
            div.innerHTML = `
                <span class="text-sm text-[color:var(--app-text)]">${file.name} (${fileSize} MB)</span>
                ${fileSize > 10 ? '<span class="text-red-500 text-xs">File too large!</span>' : ''}
            `;
            fileList.appendChild(div);
        });
    });
</script>

<script>
    if (window.lucide) {
        lucide.createIcons();
    }
</script>
{% endblock %}

