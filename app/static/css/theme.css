:root {
  color-scheme: light;
}

html.dark {
  color-scheme: dark;
}

body {
  background-color: var(--app-bg) !important;
  color: var(--app-text) !important;
  transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
}

html:not(.theme-initialized) body {
  visibility: hidden;
}

html.theme-initialized body {
  visibility: visible;
}

/* ============================================
   CRITICAL: Override ALL Tailwind dark: classes
   This ensures CSS variables always take precedence
   ============================================ */

/* Override dark: background classes - FORCE light mode values when not in dark mode */
html:not(.dark) .dark\:bg-slate-900,
html:not(.dark) .dark\:bg-slate-800,
html:not(.dark) .dark\:bg-slate-700,
html:not(.dark) .dark\:bg-gray-800,
html:not(.dark) .dark\:bg-gray-900,
html:not(.dark) [class*="dark:bg-slate-"],
html:not(.dark) [class*="dark:bg-gray-"] {
  background-color: var(--app-card) !important;
  background-image: none !important;
}

/* Override dark: text classes */
html:not(.dark) .dark\:text-white,
html:not(.dark) .dark\:text-slate-100,
html:not(.dark) .dark\:text-slate-200,
html:not(.dark) .dark\:text-slate-300,
html:not(.dark) .dark\:text-slate-400,
html:not(.dark) .dark\:text-gray-100,
html:not(.dark) .dark\:text-gray-200,
html:not(.dark) .dark\:text-gray-300,
html:not(.dark) .dark\:text-gray-400,
html:not(.dark) [class*="dark:text-"] {
  color: var(--app-text) !important;
}

html:not(.dark) .dark\:text-slate-400,
html:not(.dark) .dark\:text-slate-500,
html:not(.dark) .dark\:text-gray-400,
html:not(.dark) .dark\:text-gray-500 {
  color: var(--app-muted) !important;
}

/* Override dark: border classes */
html:not(.dark) .dark\:border-slate-700,
html:not(.dark) .dark\:border-slate-600,
html:not(.dark) .dark\:border-gray-700,
html:not(.dark) .dark\:border-gray-600,
html:not(.dark) [class*="dark:border-slate-"],
html:not(.dark) [class*="dark:border-gray-"] {
  border-color: var(--app-border) !important;
}

/* Override dark: hover classes */
html:not(.dark) .dark\:hover\:bg-slate-800:hover,
html:not(.dark) .dark\:hover\:bg-slate-700:hover,
html:not(.dark) .dark\:hover\:bg-gray-800:hover,
html:not(.dark) [class*="dark:hover:bg-"]:hover {
  background-color: var(--app-surface-hover) !important;
}

html:not(.dark) .dark\:hover\:text-white:hover,
html:not(.dark) [class*="dark:hover:text-"]:hover {
  color: var(--app-text) !important;
}

/* Override dark: ring classes */
html:not(.dark) .dark\:ring-slate-700,
html:not(.dark) [class*="dark:ring-"] {
  --tw-ring-color: var(--app-border) !important;
}

/* ============================================
   Light mode surface backgrounds
   ============================================ */
.bg-white,
.bg-gray-50,
.bg-gray-100,
.bg-gray-200,
.bg-gray-300,
.bg-slate-50,
.bg-slate-100,
.bg-slate-200,
.bg-slate-300,
[class*="bg-white/"],
[class*="bg-gray-50/"],
[class*="bg-gray-100/"],
[class*="bg-slate-50/"],
[class*="bg-slate-100/"] {
  background-color: var(--app-card) !important;
}

/* Muted surface hover states */
.hover\:bg-slate-100:hover,
.hover\:bg-slate-200:hover,
.hover\:bg-gray-50:hover,
.hover\:bg-gray-100:hover,
.hover\:bg-white:hover,
.hover\:bg-white\/90:hover,
.hover\:bg-white\/80:hover {
  background-color: var(--app-surface-hover) !important;
}

/* Text colors */
.text-black,
.text-slate-900,
.text-slate-800,
.text-gray-900,
.text-gray-800 {
  color: var(--app-text) !important;
}

.text-slate-700,
.text-slate-600,
.text-slate-500,
.text-slate-400,
.text-gray-700,
.text-gray-600,
.text-gray-500,
.text-gray-400 {
  color: var(--app-muted) !important;
}

/* Border utilities */
.border-gray-100,
.border-gray-200,
.border-gray-300,
.border-slate-100,
.border-slate-200,
.border-slate-300,
.divide-gray-100,
.divide-gray-200,
.divide-gray-300,
.divide-slate-100,
.divide-slate-200,
.divide-slate-300 {
  border-color: var(--app-border) !important;
}

/* Ring offsets */
.ring-offset-white,
.ring-offset-slate-50 {
  --tw-ring-offset-color: var(--app-card) !important;
}

/* ============================================
   Inputs - Ensure consistent theming
   ============================================ */
input,
textarea,
select {
  background-color: var(--app-input) !important;
  color: var(--app-text) !important;
  border-color: var(--app-border) !important;
}

input::placeholder,
textarea::placeholder {
  color: var(--app-muted) !important;
}

/* Override dark: input classes */
html:not(.dark) .dark\:bg-slate-800\/50,
html:not(.dark) [class*="dark:bg-"] {
  background-color: var(--app-input) !important;
}

html:not(.dark) .dark\:border-slate-700 {
  border-color: var(--app-border) !important;
}

/* ============================================
   Mobile-specific fixes
   ============================================ */
@media (max-width: 768px) {
  /* Force recalculation of CSS variables on mobile */
  html:not(.dark) * {
    background-color: inherit;
  }
  
  /* Ensure all containers respect theme */
  html:not(.dark) [class*="bg-"],
  html:not(.dark) [class*="dark:bg-"] {
    background-color: var(--app-bg) !important;
  }
  
  html:not(.dark) [class*="bg-"]:not([class*="gradient"]):not([class*="from-"]):not([class*="to-"]) {
    background-color: var(--app-card) !important;
  }
}

/* ============================================
   Ensure backdrop and overlay elements respect theme
   ============================================ */
html:not(.dark) [class*="backdrop-blur"] {
  background-color: var(--app-card) !important;
}

/* ============================================
   Dark mode specific overrides (when dark class is present)
   ============================================ */
html.dark input,
html.dark textarea,
html.dark select {
  background-color: var(--app-input) !important;
  color: var(--app-text) !important;
  border-color: var(--app-border) !important;
}

html.dark input::placeholder,
html.dark textarea::placeholder {
  color: var(--app-muted) !important;
}

/* ============================================
   Lucide Icons - Ensure they inherit theme colors
   ============================================ */
i[data-lucide],
svg[data-lucide-icon] {
  color: inherit !important;
  stroke: currentColor !important;
  fill: none !important;
}

/* Ensure Lucide icons in buttons and links inherit parent color */
button i[data-lucide],
a i[data-lucide],
[class*="text-"] i[data-lucide] {
  color: inherit !important;
  stroke: currentColor !important;
}

/* All other Lucide icons should inherit from parent */
/* Note: text-cyan-400 and text-yellow-400 are allowed for theme toggle icons */
i[data-lucide]:not(.text-cyan-400):not(.text-yellow-400) {
  color: inherit !important;
}

/* ============================================
   Button text colors - Ensure they use CSS variables
   ============================================ */
button:not([class*="bg-gradient"]):not([class*="text-white"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-blue"]):not([class*="text-cyan"]):not([class*="text-yellow"]),
a:not([class*="bg-gradient"]):not([class*="text-white"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-blue"]):not([class*="text-cyan"]):not([class*="text-yellow"]) {
  color: var(--app-text) !important;
}

/* Add to Cart buttons and similar action buttons */
.add-to-cart-btn,
.add-to-cart-text {
  color: inherit !important;
}

/* ============================================
   Force immediate theme application (no transition delay)
   ============================================ */
html.theme-changing * {
  transition: none !important;
}

html.theme-changing {
  transition: none !important;
}

/* ============================================
   Mobile Curved Floating Bottom Navigation Bar
   ============================================ */

/* Navigation CSS Variables - Light Mode */
:root {
  --nav-bg: #ffffff;
  --nav-border: rgba(0, 0, 0, 0.08);
  --nav-icon: #64748b;
  --nav-icon-active: #06b6d4; /* cyan-500 */
  --nav-shadow: rgba(0, 0, 0, 0.1);
}

/* Navigation CSS Variables - Dark Mode */
html.dark {
  --nav-bg: rgba(15, 23, 42, 0.95);
  --nav-border: rgba(255, 255, 255, 0.1);
  --nav-icon: #94a3b8;
  --nav-icon-active: #22d3ee; /* cyan-400 */
  --nav-shadow: rgba(0, 0, 0, 0.6);
}

/* HIDE ON DESKTOP - Completely hidden on tablets and desktops */
@media (min-width: 769px) {
  .curved-nav,
  .mobile-bottom-nav {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }
  
  /* Remove body padding on desktop */
  body {
    padding-bottom: 0 !important;
  }
}

/* MOBILE CURVED FLOATING NAV BAR - HORIZONTAL LAYOUT */
@media (max-width: 768px) {
  /* Main Navigation Container - FLOATING & FIXED AT BOTTOM */
  .curved-nav,
  .mobile-bottom-nav {
    position: fixed !important;
    bottom: 12px !important; /* Floating above bottom */
    left: 50% !important;
    transform: translateX(-50%) !important; /* Center horizontally */
    width: calc(100% - 24px) !important; /* 12px margin on each side */
    max-width: 500px !important; /* Max width for larger phones */
    height: auto !important;
    min-height: 70px;
    background: var(--nav-bg) !important;
    border-radius: 28px !important; /* Fully rounded corners for floating effect */
    display: flex !important;
    flex-direction: row !important; /* CRITICAL: Force horizontal */
    flex-wrap: nowrap !important;
    justify-content: space-around !important;
    align-items: center !important;
    padding: 10px 8px !important;
    padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px)) !important;
    padding-bottom: calc(10px + constant(safe-area-inset-bottom, 0px)) !important; /* iOS fallback */
    box-shadow: 0 10px 40px var(--nav-shadow), 
                0 4px 12px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(0, 0, 0, 0.05) !important; /* Enhanced multi-layer shadow for floating effect */
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid var(--nav-border) !important; /* Border on all sides */
    z-index: 999999 !important;
    transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease !important;
    margin: 0 auto !important;
    box-sizing: border-box !important;
  }
  
  /* Ensure transform doesn't interfere with active item animations */
  .curved-nav .nav-item.active,
  .mobile-bottom-nav .nav-item.active {
    transform: translateY(-8px) !important;
  }

  /* Navigation Items - HORIZONTAL ROW */
  .curved-nav .nav-item,
  .mobile-bottom-nav .nav-item {
    flex: 1 1 0% !important; /* Equal width distribution */
    min-width: 0 !important;
    max-width: 100% !important;
    text-align: center !important;
    text-decoration: none !important;
    color: var(--nav-icon) !important;
    display: flex !important;
    flex-direction: column !important; /* Icon above text */
    align-items: center !important;
    justify-content: center !important;
    gap: 4px !important;
    padding: 6px 4px !important;
    margin: 0 !important;
    transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), 
                color 0.3s ease, 
                opacity 0.3s ease !important;
    -webkit-tap-highlight-color: transparent !important;
    touch-action: manipulation !important;
    user-select: none !important;
    -webkit-user-select: none !important;
    opacity: 0.75 !important;
    position: relative !important;
    border: none !important;
    background: transparent !important;
    outline: none !important;
  }

  /* Haptic-like tap effect */
  .curved-nav .nav-item:active,
  .mobile-bottom-nav .nav-item:active,
  .curved-nav .nav-item.nav-item-clicked,
  .mobile-bottom-nav .nav-item.nav-item-clicked {
    transform: scale(0.92) !important;
    opacity: 0.6 !important;
  }
  
  /* Active items should maintain their transform even when clicked */
  .curved-nav .nav-item.active:active,
  .mobile-bottom-nav .nav-item.active:active,
  .curved-nav .nav-item.active.nav-item-clicked,
  .mobile-bottom-nav .nav-item.active.nav-item-clicked {
    transform: translateY(-8px) scale(0.95) !important;
  }
  
  /* Ensure parent transform doesn't interfere with child transforms */
  .curved-nav,
  .mobile-bottom-nav {
    transform: translateX(-50%) !important;
  }

  /* Icons - Horizontal alignment */
  .curved-nav .nav-item i[data-lucide],
  .mobile-bottom-nav .nav-item i[data-lucide] {
    width: 24px !important;
    height: 24px !important;
    stroke-width: 2 !important;
    color: inherit !important;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), 
                color 0.3s ease,
                stroke-width 0.3s ease !important;
    display: block !important;
    flex-shrink: 0 !important;
    margin: 0 !important;
  }

  /* Text labels */
  .curved-nav .nav-item span,
  .mobile-bottom-nav .nav-item span {
    font-size: 11px !important;
    font-weight: 500 !important;
    line-height: 1.2 !important;
    color: inherit !important;
    transition: color 0.3s ease, font-weight 0.3s ease !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-width: 100% !important;
    display: block !important;
  }

  /* ACTIVE TAB â€” Animated pop-up effect */
  .curved-nav .nav-item.active,
  .mobile-bottom-nav .nav-item.active {
    transform: translateY(-8px) !important;
    color: var(--nav-icon-active) !important;
    opacity: 1 !important;
  }

  .curved-nav .nav-item.active i[data-lucide],
  .mobile-bottom-nav .nav-item.active i[data-lucide] {
    transform: scale(1.3) !important;
    color: var(--nav-icon-active) !important;
    stroke-width: 2.5 !important;
  }

  .curved-nav .nav-item.active span,
  .mobile-bottom-nav .nav-item.active span {
    font-weight: 600 !important;
    color: var(--nav-icon-active) !important;
  }

  /* Prevent content from going under floating nav - Override Tailwind pb-20 */
  body {
    padding-bottom: calc(94px + env(safe-area-inset-bottom, 0px)) !important; /* 70px nav + 12px bottom + 12px margin */
    padding-bottom: calc(94px + constant(safe-area-inset-bottom, 0px)) !important; /* iOS fallback */
  }
  
  /* Ensure main content container also respects padding */
  .min-h-screen {
    padding-bottom: calc(94px + env(safe-area-inset-bottom, 0px)) !important;
    padding-bottom: calc(94px + constant(safe-area-inset-bottom, 0px)) !important;
  }
}

/* Extra small devices (phones) */
@media (max-width: 480px) {
  .curved-nav,
  .mobile-bottom-nav {
    bottom: 10px !important; /* Slightly less margin on smaller screens */
    width: calc(100% - 20px) !important; /* 10px margin on each side */
    min-height: 68px !important;
    border-radius: 24px !important;
    padding: 8px 4px !important;
    padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px)) !important;
    padding-bottom: calc(8px + constant(safe-area-inset-bottom, 0px)) !important;
  }

  .curved-nav .nav-item,
  .mobile-bottom-nav .nav-item {
    padding: 5px 2px !important;
    gap: 3px !important;
  }

  .curved-nav .nav-item i[data-lucide],
  .mobile-bottom-nav .nav-item i[data-lucide] {
    width: 22px !important;
    height: 22px !important;
  }

  .curved-nav .nav-item span,
  .mobile-bottom-nav .nav-item span {
    font-size: 10px !important;
  }

  body {
    padding-bottom: calc(90px + env(safe-area-inset-bottom, 0px)) !important; /* 68px nav + 10px bottom + 12px margin */
    padding-bottom: calc(90px + constant(safe-area-inset-bottom, 0px)) !important;
  }
  
  .min-h-screen {
    padding-bottom: calc(90px + env(safe-area-inset-bottom, 0px)) !important;
    padding-bottom: calc(90px + constant(safe-area-inset-bottom, 0px)) !important;
  }
}

/* Very small devices */
@media (max-width: 360px) {
  .curved-nav .nav-item span,
  .mobile-bottom-nav .nav-item span {
    font-size: 9px !important;
  }
  
  .curved-nav .nav-item i[data-lucide],
  .mobile-bottom-nav .nav-item i[data-lucide] {
    width: 20px !important;
    height: 20px !important;
  }
}