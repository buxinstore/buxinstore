:root {
  color-scheme: light;
}

html.dark {
  color-scheme: dark;
}

body {
  background-color: var(--app-bg) !important;
  color: var(--app-text) !important;
  transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
}

html:not(.theme-initialized) body {
  visibility: hidden;
}

html.theme-initialized body {
  visibility: visible;
}

/* ============================================
   CRITICAL: Override ALL Tailwind dark: classes
   This ensures CSS variables always take precedence
   ============================================ */

/* Override dark: background classes - FORCE light mode values when not in dark mode */
html:not(.dark) .dark\:bg-slate-900,
html:not(.dark) .dark\:bg-slate-800,
html:not(.dark) .dark\:bg-slate-700,
html:not(.dark) .dark\:bg-gray-800,
html:not(.dark) .dark\:bg-gray-900,
html:not(.dark) [class*="dark:bg-slate-"],
html:not(.dark) [class*="dark:bg-gray-"] {
  background-color: var(--app-card) !important;
  background-image: none !important;
}

/* Override dark: text classes */
html:not(.dark) .dark\:text-white,
html:not(.dark) .dark\:text-slate-100,
html:not(.dark) .dark\:text-slate-200,
html:not(.dark) .dark\:text-slate-300,
html:not(.dark) .dark\:text-slate-400,
html:not(.dark) .dark\:text-gray-100,
html:not(.dark) .dark\:text-gray-200,
html:not(.dark) .dark\:text-gray-300,
html:not(.dark) .dark\:text-gray-400,
html:not(.dark) [class*="dark:text-"] {
  color: var(--app-text) !important;
}

html:not(.dark) .dark\:text-slate-400,
html:not(.dark) .dark\:text-slate-500,
html:not(.dark) .dark\:text-gray-400,
html:not(.dark) .dark\:text-gray-500 {
  color: var(--app-muted) !important;
}

/* Override dark: border classes */
html:not(.dark) .dark\:border-slate-700,
html:not(.dark) .dark\:border-slate-600,
html:not(.dark) .dark\:border-gray-700,
html:not(.dark) .dark\:border-gray-600,
html:not(.dark) [class*="dark:border-slate-"],
html:not(.dark) [class*="dark:border-gray-"] {
  border-color: var(--app-border) !important;
}

/* Override dark: hover classes */
html:not(.dark) .dark\:hover\:bg-slate-800:hover,
html:not(.dark) .dark\:hover\:bg-slate-700:hover,
html:not(.dark) .dark\:hover\:bg-gray-800:hover,
html:not(.dark) [class*="dark:hover:bg-"]:hover {
  background-color: var(--app-surface-hover) !important;
}

html:not(.dark) .dark\:hover\:text-white:hover,
html:not(.dark) [class*="dark:hover:text-"]:hover {
  color: var(--app-text) !important;
}

/* Override dark: ring classes */
html:not(.dark) .dark\:ring-slate-700,
html:not(.dark) [class*="dark:ring-"] {
  --tw-ring-color: var(--app-border) !important;
}

/* ============================================
   Light mode surface backgrounds
   ============================================ */
.bg-white,
.bg-gray-50,
.bg-gray-100,
.bg-gray-200,
.bg-gray-300,
.bg-slate-50,
.bg-slate-100,
.bg-slate-200,
.bg-slate-300,
[class*="bg-white/"],
[class*="bg-gray-50/"],
[class*="bg-gray-100/"],
[class*="bg-slate-50/"],
[class*="bg-slate-100/"] {
  background-color: var(--app-card) !important;
}

/* Muted surface hover states */
.hover\:bg-slate-100:hover,
.hover\:bg-slate-200:hover,
.hover\:bg-gray-50:hover,
.hover\:bg-gray-100:hover,
.hover\:bg-white:hover,
.hover\:bg-white\/90:hover,
.hover\:bg-white\/80:hover {
  background-color: var(--app-surface-hover) !important;
}

/* Text colors */
.text-black,
.text-slate-900,
.text-slate-800,
.text-gray-900,
.text-gray-800 {
  color: var(--app-text) !important;
}

.text-slate-700,
.text-slate-600,
.text-slate-500,
.text-slate-400,
.text-gray-700,
.text-gray-600,
.text-gray-500,
.text-gray-400 {
  color: var(--app-muted) !important;
}

/* Border utilities */
.border-gray-100,
.border-gray-200,
.border-gray-300,
.border-slate-100,
.border-slate-200,
.border-slate-300,
.divide-gray-100,
.divide-gray-200,
.divide-gray-300,
.divide-slate-100,
.divide-slate-200,
.divide-slate-300 {
  border-color: var(--app-border) !important;
}

/* Ring offsets */
.ring-offset-white,
.ring-offset-slate-50 {
  --tw-ring-offset-color: var(--app-card) !important;
}

/* ============================================
   Inputs - Ensure consistent theming
   ============================================ */
input,
textarea,
select {
  background-color: var(--app-input) !important;
  color: var(--app-text) !important;
  border-color: var(--app-border) !important;
}

input::placeholder,
textarea::placeholder {
  color: var(--app-muted) !important;
}

/* Override dark: input classes */
html:not(.dark) .dark\:bg-slate-800\/50,
html:not(.dark) [class*="dark:bg-"] {
  background-color: var(--app-input) !important;
}

html:not(.dark) .dark\:border-slate-700 {
  border-color: var(--app-border) !important;
}

/* ============================================
   Mobile-specific fixes
   ============================================ */
@media (max-width: 768px) {
  /* Force recalculation of CSS variables on mobile */
  html:not(.dark) * {
    background-color: inherit;
  }
  
  /* Ensure all containers respect theme */
  html:not(.dark) [class*="bg-"],
  html:not(.dark) [class*="dark:bg-"] {
    background-color: var(--app-bg) !important;
  }
  
  html:not(.dark) [class*="bg-"]:not([class*="gradient"]):not([class*="from-"]):not([class*="to-"]) {
    background-color: var(--app-card) !important;
  }
}

/* ============================================
   Ensure backdrop and overlay elements respect theme
   ============================================ */
html:not(.dark) [class*="backdrop-blur"] {
  background-color: var(--app-card) !important;
}

/* ============================================
   Dark mode specific overrides (when dark class is present)
   ============================================ */
html.dark input,
html.dark textarea,
html.dark select {
  background-color: var(--app-input) !important;
  color: var(--app-text) !important;
  border-color: var(--app-border) !important;
}

html.dark input::placeholder,
html.dark textarea::placeholder {
  color: var(--app-muted) !important;
}

/* ============================================
   Lucide Icons - Ensure they inherit theme colors
   ============================================ */
i[data-lucide],
svg[data-lucide-icon] {
  color: inherit !important;
  stroke: currentColor !important;
  fill: none !important;
}

/* Ensure Lucide icons in buttons and links inherit parent color */
button i[data-lucide],
a i[data-lucide],
[class*="text-"] i[data-lucide] {
  color: inherit !important;
  stroke: currentColor !important;
}

/* All other Lucide icons should inherit from parent */
/* Note: text-cyan-400 and text-yellow-400 are allowed for theme toggle icons */
i[data-lucide]:not(.text-cyan-400):not(.text-yellow-400) {
  color: inherit !important;
}

/* ============================================
   Button text colors - Ensure they use CSS variables
   ============================================ */
button:not([class*="bg-gradient"]):not([class*="text-white"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-blue"]):not([class*="text-cyan"]):not([class*="text-yellow"]),
a:not([class*="bg-gradient"]):not([class*="text-white"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-blue"]):not([class*="text-cyan"]):not([class*="text-yellow"]) {
  color: var(--app-text) !important;
}

/* Add to Cart buttons and similar action buttons */
.add-to-cart-btn,
.add-to-cart-text {
  color: inherit !important;
}

/* ============================================
   Force immediate theme application (no transition delay)
   ============================================ */
html.theme-changing * {
  transition: none !important;
}

html.theme-changing {
  transition: none !important;
}

/* ============================================
   Mobile Curved Floating Bottom Navigation Bar
   ============================================ */

/* Navigation CSS Variables - Light Mode */
:root {
  --nav-bg: #ffffff;
  --nav-border: #e6e6e6;
  --nav-icon: #222222;
  --nav-active: #06b6d4; /* cyan-500 */
}

/* Navigation CSS Variables - Dark Mode */
html.dark {
  --nav-bg: rgba(20, 20, 20, 0.92);
  --nav-border: #333333;
  --nav-icon: #dddddd;
  --nav-active: #22d3ee; /* cyan-400 */
}

/* HIDE ON DESKTOP */
@media (min-width: 769px) {
  .curved-nav,
  .mobile-bottom-nav {
    display: none !important;
  }
}

/* MOBILE CURVED FLOATING NAV BAR */
@media (max-width: 768px) {
  .curved-nav {
    position: fixed !important;
    bottom: 0 !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 92% !important;
    max-width: 500px;
    height: 70px;
    background: var(--nav-bg);
    border-radius: 25px 25px 0 0;
    display: flex !important;
    flex-direction: row !important;
    justify-content: space-around;
    align-items: center;
    padding: 8px 0;
    padding-bottom: calc(8px + env(safe-area-inset-bottom, 0));
    padding-bottom: calc(8px + constant(safe-area-inset-bottom, 0));
    box-shadow: 0 -6px 25px rgba(0, 0, 0, 0.20);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid var(--nav-border);
    z-index: 999999;
    transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
  }

  html.dark .curved-nav {
    box-shadow: 0 -6px 25px rgba(0, 0, 0, 0.50);
  }

  .curved-nav .nav-item {
    flex: 1;
    text-align: center;
    text-decoration: none;
    color: var(--nav-icon);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    transition: transform 0.20s ease, color 0.3s ease, opacity 0.3s ease;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;
    padding: 4px 2px;
    min-width: 0;
    opacity: 0.9;
  }

  /* Haptic-like tap effect */
  .curved-nav .nav-item:active {
    transform: scale(0.88);
    opacity: 0.7;
  }

  /* Icons */
  .curved-nav .nav-item i[data-lucide] {
    width: 26px;
    height: 26px;
    stroke-width: 2;
    margin-bottom: 2px;
    color: inherit;
    transition: transform 0.25s ease, color 0.3s;
    display: block;
  }

  .curved-nav .nav-item span {
    font-size: 11px;
    font-weight: 500;
    line-height: 1.2;
    color: inherit;
    transition: color 0.3s, font-weight 0.3s;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  /* ACTIVE TAB â€” bubble animation */
  .curved-nav .nav-item.active {
    transform: translateY(-6px);
    color: var(--nav-active);
    opacity: 1;
  }

  .curved-nav .nav-item.active i[data-lucide] {
    transform: scale(1.25);
    color: var(--nav-active);
    stroke-width: 2.5;
  }

  .curved-nav .nav-item.active span {
    font-weight: 600;
    color: var(--nav-active);
  }

  /* Prevent content from going under nav */
  body {
    padding-bottom: calc(90px + env(safe-area-inset-bottom, 0)) !important;
    padding-bottom: calc(90px + constant(safe-area-inset-bottom, 0)) !important;
  }
}

/* Extra small devices */
@media (max-width: 480px) {
  .curved-nav {
    width: 95%;
    height: 68px;
  }

  .curved-nav .nav-item i[data-lucide] {
    width: 24px;
    height: 24px;
  }

  .curved-nav .nav-item span {
    font-size: 10px;
  }

  body {
    padding-bottom: calc(88px + env(safe-area-inset-bottom, 0)) !important;
    padding-bottom: calc(88px + constant(safe-area-inset-bottom, 0)) !important;
  }
}