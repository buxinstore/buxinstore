:root {
  color-scheme: light;
}

html.dark {
  color-scheme: dark;
}

body {
  background-color: var(--app-bg) !important;
  color: var(--app-text) !important;
  transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
}

html:not(.theme-initialized) body {
  visibility: hidden;
}

html.theme-initialized body {
  visibility: visible;
}

/* ============================================
   CRITICAL: Override ALL Tailwind dark: classes
   This ensures CSS variables always take precedence
   ============================================ */

/* Override dark: background classes - FORCE light mode values when not in dark mode */
html:not(.dark) .dark\:bg-slate-900,
html:not(.dark) .dark\:bg-slate-800,
html:not(.dark) .dark\:bg-slate-700,
html:not(.dark) .dark\:bg-gray-800,
html:not(.dark) .dark\:bg-gray-900,
html:not(.dark) [class*="dark:bg-slate-"],
html:not(.dark) [class*="dark:bg-gray-"] {
  background-color: var(--app-card) !important;
  background-image: none !important;
}

/* Override dark: text classes */
html:not(.dark) .dark\:text-white,
html:not(.dark) .dark\:text-slate-100,
html:not(.dark) .dark\:text-slate-200,
html:not(.dark) .dark\:text-slate-300,
html:not(.dark) .dark\:text-slate-400,
html:not(.dark) .dark\:text-gray-100,
html:not(.dark) .dark\:text-gray-200,
html:not(.dark) .dark\:text-gray-300,
html:not(.dark) .dark\:text-gray-400,
html:not(.dark) [class*="dark:text-"] {
  color: var(--app-text) !important;
}

html:not(.dark) .dark\:text-slate-400,
html:not(.dark) .dark\:text-slate-500,
html:not(.dark) .dark\:text-gray-400,
html:not(.dark) .dark\:text-gray-500 {
  color: var(--app-muted) !important;
}

/* Override dark: border classes */
html:not(.dark) .dark\:border-slate-700,
html:not(.dark) .dark\:border-slate-600,
html:not(.dark) .dark\:border-gray-700,
html:not(.dark) .dark\:border-gray-600,
html:not(.dark) [class*="dark:border-slate-"],
html:not(.dark) [class*="dark:border-gray-"] {
  border-color: var(--app-border) !important;
}

/* Override dark: hover classes */
html:not(.dark) .dark\:hover\:bg-slate-800:hover,
html:not(.dark) .dark\:hover\:bg-slate-700:hover,
html:not(.dark) .dark\:hover\:bg-gray-800:hover,
html:not(.dark) [class*="dark:hover:bg-"]:hover {
  background-color: var(--app-surface-hover) !important;
}

html:not(.dark) .dark\:hover\:text-white:hover,
html:not(.dark) [class*="dark:hover:text-"]:hover {
  color: var(--app-text) !important;
}

/* Override dark: ring classes */
html:not(.dark) .dark\:ring-slate-700,
html:not(.dark) [class*="dark:ring-"] {
  --tw-ring-color: var(--app-border) !important;
}

/* ============================================
   Light mode surface backgrounds
   ============================================ */
.bg-white,
.bg-gray-50,
.bg-gray-100,
.bg-gray-200,
.bg-gray-300,
.bg-slate-50,
.bg-slate-100,
.bg-slate-200,
.bg-slate-300,
[class*="bg-white/"],
[class*="bg-gray-50/"],
[class*="bg-gray-100/"],
[class*="bg-slate-50/"],
[class*="bg-slate-100/"] {
  background-color: var(--app-card) !important;
}

/* Muted surface hover states */
.hover\:bg-slate-100:hover,
.hover\:bg-slate-200:hover,
.hover\:bg-gray-50:hover,
.hover\:bg-gray-100:hover,
.hover\:bg-white:hover,
.hover\:bg-white\/90:hover,
.hover\:bg-white\/80:hover {
  background-color: var(--app-surface-hover) !important;
}

/* Text colors */
.text-black,
.text-slate-900,
.text-slate-800,
.text-gray-900,
.text-gray-800 {
  color: var(--app-text) !important;
}

.text-slate-700,
.text-slate-600,
.text-slate-500,
.text-slate-400,
.text-gray-700,
.text-gray-600,
.text-gray-500,
.text-gray-400 {
  color: var(--app-muted) !important;
}

/* Border utilities */
.border-gray-100,
.border-gray-200,
.border-gray-300,
.border-slate-100,
.border-slate-200,
.border-slate-300,
.divide-gray-100,
.divide-gray-200,
.divide-gray-300,
.divide-slate-100,
.divide-slate-200,
.divide-slate-300 {
  border-color: var(--app-border) !important;
}

/* Ring offsets */
.ring-offset-white,
.ring-offset-slate-50 {
  --tw-ring-offset-color: var(--app-card) !important;
}

/* ============================================
   Inputs - Ensure consistent theming
   ============================================ */
input,
textarea,
select {
  background-color: var(--app-input) !important;
  color: var(--app-text) !important;
  border-color: var(--app-border) !important;
}

input::placeholder,
textarea::placeholder {
  color: var(--app-muted) !important;
}

/* Override dark: input classes */
html:not(.dark) .dark\:bg-slate-800\/50,
html:not(.dark) [class*="dark:bg-"] {
  background-color: var(--app-input) !important;
}

html:not(.dark) .dark\:border-slate-700 {
  border-color: var(--app-border) !important;
}

/* ============================================
   Mobile-specific fixes
   ============================================ */
@media (max-width: 768px) {
  /* Force recalculation of CSS variables on mobile */
  html:not(.dark) * {
    background-color: inherit;
  }
  
  /* Ensure all containers respect theme */
  html:not(.dark) [class*="bg-"],
  html:not(.dark) [class*="dark:bg-"] {
    background-color: var(--app-bg) !important;
  }
  
  html:not(.dark) [class*="bg-"]:not([class*="gradient"]):not([class*="from-"]):not([class*="to-"]) {
    background-color: var(--app-card) !important;
  }
}

/* ============================================
   Ensure backdrop and overlay elements respect theme
   ============================================ */
html:not(.dark) [class*="backdrop-blur"] {
  background-color: var(--app-card) !important;
}

/* ============================================
   Dark mode specific overrides (when dark class is present)
   ============================================ */
html.dark input,
html.dark textarea,
html.dark select {
  background-color: var(--app-input) !important;
  color: var(--app-text) !important;
  border-color: var(--app-border) !important;
}

html.dark input::placeholder,
html.dark textarea::placeholder {
  color: var(--app-muted) !important;
}

/* ============================================
   Lucide Icons - Ensure they inherit theme colors
   ============================================ */
i[data-lucide],
svg[data-lucide-icon] {
  color: inherit !important;
  stroke: currentColor !important;
  fill: none !important;
}

/* Ensure Lucide icons in buttons and links inherit parent color */
button i[data-lucide],
a i[data-lucide],
[class*="text-"] i[data-lucide] {
  color: inherit !important;
  stroke: currentColor !important;
}

/* All other Lucide icons should inherit from parent */
/* Note: text-cyan-400 and text-yellow-400 are allowed for theme toggle icons */
i[data-lucide]:not(.text-cyan-400):not(.text-yellow-400) {
  color: inherit !important;
}

/* ============================================
   Button text colors - Ensure they use CSS variables
   ============================================ */
button:not([class*="bg-gradient"]):not([class*="text-white"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-blue"]):not([class*="text-cyan"]):not([class*="text-yellow"]),
a:not([class*="bg-gradient"]):not([class*="text-white"]):not([class*="text-red"]):not([class*="text-green"]):not([class*="text-blue"]):not([class*="text-cyan"]):not([class*="text-yellow"]) {
  color: var(--app-text) !important;
}

/* Add to Cart buttons and similar action buttons */
.add-to-cart-btn,
.add-to-cart-text {
  color: inherit !important;
}

/* ============================================
   Force immediate theme application (no transition delay)
   ============================================ */
html.theme-changing * {
  transition: none !important;
}

html.theme-changing {
  transition: none !important;
}

/* ============================================
   Mobile Bottom Navigation Bar
   ============================================ */

/* Hide on desktop and tablets */
@media (min-width: 769px) {
  .mobile-bottom-nav {
    display: none !important;
  }
}

/* Mobile-only styles */
@media (max-width: 768px) {
  .mobile-bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background-color: var(--app-card);
    border-top: 1px solid var(--app-border);
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    /* Safe area support for iPhone with notch/dynamic island */
    padding-bottom: env(safe-area-inset-bottom, 0);
    padding-bottom: constant(safe-area-inset-bottom, 0);
  }

  html.dark .mobile-bottom-nav {
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.4);
    border-top-color: rgba(255, 255, 255, 0.15);
  }

  .mobile-bottom-nav__container {
    display: flex;
    align-items: center;
    justify-content: space-around;
    height: 60px;
    max-width: 100%;
    padding: 0 8px;
    /* Safe area support */
    padding-bottom: calc(8px + env(safe-area-inset-bottom, 0));
    padding-bottom: calc(8px + constant(safe-area-inset-bottom, 0));
  }

  .mobile-bottom-nav__item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex: 1;
    min-width: 0;
    padding: 8px 4px;
    text-decoration: none;
    color: var(--app-muted);
    transition: all 0.2s ease;
    border-radius: 12px;
    margin: 0 2px;
    position: relative;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;
  }

  .mobile-bottom-nav__item:active {
    transform: scale(0.95);
    background-color: var(--app-surface-hover);
  }

  .mobile-bottom-nav__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    margin-bottom: 4px;
    transition: all 0.2s ease;
  }

  .mobile-bottom-nav__icon i[data-lucide] {
    width: 22px;
    height: 22px;
    stroke-width: 2;
    color: inherit;
  }

  .mobile-bottom-nav__label {
    font-size: 11px;
    font-weight: 500;
    line-height: 1.2;
    text-align: center;
    transition: all 0.2s ease;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  /* Active state */
  .mobile-bottom-nav__item--active {
    color: #06b6d4; /* cyan-500 */
    font-weight: 600;
  }

  html.dark .mobile-bottom-nav__item--active {
    color: #22d3ee; /* cyan-400 for dark mode */
  }

  .mobile-bottom-nav__item--active .mobile-bottom-nav__icon {
    transform: scale(1.1);
  }

  .mobile-bottom-nav__item--active .mobile-bottom-nav__icon i[data-lucide] {
    stroke-width: 2.5;
  }

  .mobile-bottom-nav__item--active .mobile-bottom-nav__label {
    font-weight: 700;
  }

  /* Add subtle background to active item */
  .mobile-bottom-nav__item--active::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(37, 99, 235, 0.1));
    border-radius: 12px;
    z-index: -1;
    opacity: 0.6;
  }

  html.dark .mobile-bottom-nav__item--active::before {
    background: linear-gradient(135deg, rgba(34, 211, 238, 0.15), rgba(59, 130, 246, 0.15));
  }

  /* Hover state for devices that support it */
  @media (hover: hover) {
    .mobile-bottom-nav__item:hover:not(.mobile-bottom-nav__item--active) {
      color: var(--app-text);
      background-color: var(--app-surface-hover);
    }
  }

  /* Ensure body has padding at bottom to prevent content overlap */
  body {
    padding-bottom: calc(60px + env(safe-area-inset-bottom, 0)) !important;
    padding-bottom: calc(60px + constant(safe-area-inset-bottom, 0)) !important;
  }
}

/* Extra small devices - adjust height slightly */
@media (max-width: 480px) {
  .mobile-bottom-nav__container {
    height: 56px;
    padding: 0 4px;
  }

  .mobile-bottom-nav__icon {
    width: 22px;
    height: 22px;
  }

  .mobile-bottom-nav__icon i[data-lucide] {
    width: 20px;
    height: 20px;
  }

  .mobile-bottom-nav__label {
    font-size: 10px;
  }

  body {
    padding-bottom: calc(56px + env(safe-area-inset-bottom, 0)) !important;
    padding-bottom: calc(56px + constant(safe-area-inset-bottom, 0)) !important;
  }
}